{% comment %}theme-check-disable UnusedAssign{% endcomment %}
{%- liquid
  assign layout = 'customers-addresses'
  if "ar he he-IL hi" contains localization.language.iso_code
    assign rtl = '-rtl'
  endif

  assign store_width = settings.container_max_width

  if section.settings.section_width == 'custom'
    assign store_width = section.settings.container_max_width
  endif

  if template.suffix contains 'store-width-'
    assign store_width = template.suffix | split: 'store-width-' | last | plus: 0
  endif

-%}

<div class="{% render 'section-class', layout: layout %}" {% render 'section-style', layout: layout %} data-customer-addresses>
  <div class="{% render 'section-container-class', layout: layout %}">

    <div class="title-wrap text-center mb-1">
      <h1 class="h1-style">{{ 'customer.addresses.title' | t }}</h1>
    </div>
    <div class="text-center"><a href="{{ routes.account_url }}" class="btn-link btn-link--md"><span
            class="icon-wrap">{% render 'icon-back' %}</span><span>{{ 'customer.account.return' | t }}</span></a>
    </div>

    <div data-address>
      <div class="text-center mt-3">
        <button
            class="btn"
            type="button"
            aria-expanded="false"
            aria-controls="AddAddress"
        >
          {{ 'customer.addresses.add_new' | t }}
        </button>
      </div>

      <div id="AddAddress" class="mt-5 hidden">
        <div class="custom-card bg-alt">
          <div class="custom-card-inside">
            {%- form 'customer_address', customer.new_address, aria-labelledBy: 'AddressNewHeading' -%}
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <h2 class="mt-3" id="AddressNewHeading">{{ 'customer.addresses.add_new' | t }}</h2>
                </div>
                <div class="col-lg-8">
                  <div class="row gy-4">
                    <div class="col-6">
                      <div class="form-group">
                        <label for="AddressFirstNameNew">{{ 'customer.addresses.first_name' | t }}</label>
                        <div class="form-control-wrap">
                          <input class="form-control" required type="text" id="AddressFirstNameNew" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name" placeholder="{{ 'customer.addresses.first_name' | t }}">
                          {% render 'input-check' %}
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-group">
                        <label for="AddressLastNameNew">{{ 'customer.addresses.last_name' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text" class="form-control" id="AddressLastNameNew" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name" placeholder="{{ 'customer.addresses.last_name' | t }}">
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="form-group">
                        <label for="AddressCompanyNew">{{ 'customer.addresses.company' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text"  class="form-control" id="AddressCompanyNew" name="address[company]" value="{{ form.company }}" autocomplete="organization" placeholder="{{ 'customer.addresses.company' | t }}">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="AddressAddress1New">{{ 'customer.addresses.address1' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text" class="form-control" required id="AddressAddress1New" name="address[address1]" value="{{ form.address1 }}" autocomplete="address-line1" placeholder="{{ 'customer.addresses.address1' | t }}">
                          {% render 'input-check' %}
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="AddressAddress2New">{{ 'customer.addresses.address2' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text" class="form-control" id="AddressAddress2New" name="address[address2]" value="{{ form.address2 }}" autocomplete="address-line2" placeholder="{{ 'customer.addresses.address2' | t }}">
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="AddressCityNew">{{ 'customer.addresses.city' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text" required class="form-control" id="AddressCityNew" name="address[city]" value="{{ form.city }}" autocomplete="address-level2" placeholder="{{ 'customer.addresses.city' | t }}">
                          {% render 'input-check' %}
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="AddressCountryNew">
                          {{ 'customer.addresses.country' | t }}
                        </label>
                        <div class="form-control-wrap form-control-wrap--select">
                          <select
                              id="AddressCountryNew"
                              name="address[country]"
                              data-default="{{ form.country }}"
                              autocomplete="country"
                              class="form-select"
                              required
                          >
                            {{ all_country_option_tags | replace: 'value="---"', 'value=""' }}
                          </select>
                        </div>
                      </div>

                      <div class="form-group" id="AddressProvinceContainerNew" style="display:none;">
                        <label for="AddressProvinceNew">
                          {{ 'customer.addresses.province' | t }}
                        </label>
                        <div class="form-control-wrap form-control-wrap--select">
                          <select
                              id="AddressProvinceNew"
                              name="address[province]"
                              data-default="{{ form.province }}"
                              autocomplete="address-level1"
                              class="form-select"
                          >
                          </select>
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="AddressZipNew">{{ 'customer.addresses.zip' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="text" required pattern="[0-9]{5}|[0-9]{4}([A-Za-z]{2})?" class="form-control" id="AddressZipNew" name="address[zip]" value="{{ form.zip }}" autocapitalize="characters" autocomplete="postal-code" placeholder="{{ 'customer.addresses.zip' | t }}">
                          {% render 'input-check' %}
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="AddressPhoneNew">{{ 'customer.addresses.phone' | t }}</label>
                        <div class="form-control-wrap">
                          <input type="tel" class="form-control" id="AddressPhoneNew"  name="address[phone]" value="{{ form.phone }}" autocomplete="tel" placeholder="{{ 'customer.addresses.phone' | t }}">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="custom-form mt-2">
                    {{ form.set_as_default_checkbox }}
                    <label for="address_default_address_new">
                      {{ 'customer.addresses.set_default' | t }}
                    </label>
                  </div>
                  <div class="row mt-2 g-2">
                    <div class="col-auto"><button class="btn">{{ 'customer.addresses.add' | t }}</button></div>
                    <div class="col-auto"><button type="reset" class="btn btn--grey">{{ 'customer.addresses.cancel' | t }}</button></div>
                  </div>
                </div>
              </div>
            {%- endform -%}
          </div>
        </div>
      </div>

    </div>

    <div class="addresses-list row justify-content-center g-4" role="list">
      {%- liquid assign count = 0 -%}
      {%- for address in customer.addresses -%}
        {%- liquid assign count = count | plus: 1 -%}
        <div class="col" data-address>
          <div class="custom-card bg-alt h-100">
            <div class="custom-card-inside d-flex flex-column h-100">

                <h2 class="custom-card-title">
                 {{ 'theme.general.address' | t }} {{ count }}{% if address == customer.default_address %} ({{ 'customer.addresses.default' | t }}){% endif %}
                </h2>

              {{ address | format_address }}
              <div class="row mt-auto pt-2 g-2 justify-content-center">
                <div class="col-auto">
                  <button class="btn"
                      type="button"
                      id="EditFormButton_{{ address.id }}"
                      aria-label="{{ 'customer.addresses.edit_address' | t }} {{ forloop.index }}"
                      aria-controls="EditAddress_{{ address.id }}"
                      aria-expanded="false"
                      data-address-id="{{ address.id }}"
                  >
                    {{ 'customer.addresses.edit' | t }}
                  </button>
                </div>
                <div class="col-auto">
                  <button class="btn btn--grey"
                      type="button"
                      aria-label="{{ 'customer.addresses.delete' | t }} {{ forloop.index }}"
                      data-target="{{ address.url }}"
                      data-confirm-message="{{ 'customer.addresses.delete_confirm' | t }}"
                  >
                    {{ 'customer.addresses.delete' | t }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      {%- endfor -%}

      {%- liquid assign count = 0 -%}
      {%- for address in customer.addresses -%}
        {%- liquid assign count = count | plus: 1 -%}
          <div class="holder text-start hidden" id="EditAddress_{{ address.id }}">
              <div class="custom-card bg-alt">
                <div class="custom-card-inside">
                  {%- form 'customer_address', address -%}
                  <div class="row justify-content-center ">
                    <div class="col-lg-8">
                      <h2 class="mt-3">{{ 'customer.addresses.edit_address' | t }}: {{ 'theme.general.address' | t }} {{ count }}{% if address == customer.default_address %} ({{ 'customer.addresses.default' | t }}){% endif %}</h2>
                    </div>
                    <div class="col-lg-8">
                      <div class="row gy-4">
                        <div class="col-6">
                          <div class="form-group">
                            <label for="AddressFirstName_{{ form.id }}">{{ 'customer.addresses.first_name' | t }}</label>
                            <div class="form-control-wrap">
                              <input class="form-control" required type="text" id="AddressFirstName_{{ form.id }}" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name" placeholder="{{ 'customer.addresses.first_name' | t }}">
                              {% render 'input-check' %}
                            </div>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label for="AddressLastName_{{ form.id }}">{{ 'customer.addresses.last_name' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text" class="form-control" id="AddressLastName_{{ form.id }}" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name" placeholder="{{ 'customer.addresses.last_name' | t }}">
                            </div>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="form-group">
                            <label for="AddressCompany_{{ form.id }}">{{ 'customer.addresses.company' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text"  class="form-control" id="AddressCompany_{{ form.id }}" name="address[company]" value="{{ form.company }}" autocomplete="organization" placeholder="{{ 'customer.addresses.company' | t }}">
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="AddressAddress1_{{ form.id }}">{{ 'customer.addresses.address1' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text" required class="form-control" id="AddressAddress1_{{ form.id }}" name="address[address1]" value="{{ form.address1 }}" autocomplete="address-line1" placeholder="{{ 'customer.addresses.address1' | t }}">
                              {% render 'input-check' %}
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="AddressAddress2_{{ form.id }}">{{ 'customer.addresses.address2' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text" class="form-control" id="AddressAddress2_{{ form.id }}" name="address[address2]" value="{{ form.address2 }}" autocomplete="address-line2" placeholder="{{ 'customer.addresses.address2' | t }}">
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="AddressCity_{{ form.id }}">{{ 'customer.addresses.city' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text" required class="form-control" id="AddressCity_{{ form.id }}" name="address[city]" value="{{ form.city }}" autocomplete="address-level2" placeholder="{{ 'customer.addresses.city' | t }}">
                              {% render 'input-check' %}
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="AddressCountry_{{ form.id }}">
                              {{ 'customer.addresses.country' | t }}
                            </label>
                            <div class="form-control-wrap form-control-wrap--select">
                              <select
                                  id="AddressCountry_{{ form.id }}"
                                  class="form-select"
                                  name="address[country]"
                                  data-address-country-select
                                  data-default="{{ form.country }}"
                                  data-form-id="{{ form.id }}"
                                  autocomplete="country"
                                  required
                              >
                                {{ all_country_option_tags | replace: 'value="---"', 'value=""' }}
                              </select>
                            </div>
                          </div>

                          <div class="form-group" id="AddressProvinceContainer_{{ form.id }}" style="display:none;">
                            <label for="AddressProvince_{{ form.id }}">
                              {{ 'customer.addresses.province' | t }}
                            </label>
                            <div class="form-control-wrap form-control-wrap--select">
                              <select
                                  id="AddressProvince_{{ form.id }}"
                                  class="form-select"
                                  name="address[province]"
                                  data-default="{{ form.province }}"
                                  autocomplete="address-level1"
                              >
                              </select>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="AddressZip_{{ form.id }}">{{ 'customer.addresses.zip' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="text" required pattern="[0-9]{5}" class="form-control" id="AddressZip_{{ form.id }}" name="address[zip]" value="{{ form.zip }}" autocapitalize="characters" autocomplete="postal-code" placeholder="{{ 'customer.addresses.zip' | t }}">
                              {% render 'input-check' %}
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="AddressPhone_{{ form.id }}">{{ 'customer.addresses.phone' | t }}</label>
                            <div class="form-control-wrap">
                              <input type="tel" class="form-control" id="AddressPhone_{{ form.id }}"  name="address[phone]" value="{{ form.phone }}" autocomplete="tel" placeholder="{{ 'customer.addresses.phone' | t }}">
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="custom-form mt-2">
                        {{ form.set_as_default_checkbox }}
                        <label for="address_default_address_{{ form.id }}">
                          {{ 'customer.addresses.set_default' | t }}
                        </label>
                      </div>
                      <div class="row mt-2 g-2">
                        <div class="col-auto"><button class="btn" type="submit">{{ 'customer.addresses.update' | t }}</button></div>
                        <div class="col-auto"><button type="reset" class="btn btn--grey" data-address-id={{ address.id }}>{{ 'customer.addresses.cancel' | t }}</button></div>
                      </div>
                    </div>
                  </div>
                {%- endform -%}
                </div>
              </div>
          </div>

      {%- endfor -%}
    </div>

  </div>
</div>

<script src="{{ 'customer.js' | asset_url }}" defer></script>

<script>
  window.onload = () => {
    typeof CustomerAddresses !== 'undefined' && new CustomerAddresses();
  }
</script>

{% schema %}
{
  "name": "Main addresses",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "SECTION WIDTH"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Select width source",
      "options": [
        {
          "value": "global",
          "label": "Use store width"
        },
        {
          "value": "custom",
          "label": "Custom width"
        }
      ],
      "default": "global",
      "info": "Store width you can set in Theme Settings / General"
    },
    {
      "type": "range",
      "id": "container_max_width",
      "min": 920,
      "max": 1720,
      "step": 8,
      "unit": "px",
      "label": "Custom width",
      "default": 920,
      "info": "The specified width may differ from the actual width of the section because this section uses a smart grid for the most successful arrangement of columns in rows and for best view. Columns are not scaled, but added when the section width is increased."
    },
    {
      "type": "header",
      "content": "SECTION MARGIN"
    },
    {
      "type": "range",
      "id": "spacing_sections",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Vertical space above the section on Desktop",
      "default": 46
    },
    {
      "type": "checkbox",
      "id": "use_global_desktop_space",
      "label": "Use global space on desktop",
      "default": false,
      "info": "from Theme Settings / General / Layout"
    },
    {
      "type": "range",
      "id": "spacing_sections_mobile",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Vertical space above the section on Mobile",
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "use_global_mobile_space",
      "label": "Use global space on mobile",
      "default": false,
      "info": "from Theme Settings / General / Layout"
    }
  ]
}
{% endschema %}
