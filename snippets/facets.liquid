{% comment %}theme-check-disable ImgLazyLoading, RemoteAsset, NestedSnippet{% endcomment %}
{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  assign total_active_values = 0

  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif

  assign color_options_name = settings.product_card_color_options_name | split: ","

  assign navigation = settings.collection_categories
  assign navigation_filter = false

  if navigation != blank and navigation.links.size > 0
    assign navigation_filter = true
  endif

  assign filter_label = 'filter-group-' | append: 'categories' | handle
  assign filter_tab_status = cart.attributes[filter_label]

  if filter_tab_status == nil
    assign filter_tab_status = 'open'
  endif

  assign enable_filtering = settings.enable_filtering
-%}

<div class="filter-col-content secondary-color filter-mobile-content dropdn-content-block" data-filter>
  <!-- Page Title -->
  {%- if request.page_type == 'collection' or request.page_type == 'search' -%}
    <div class="category-page-title hide-filter-mobile">
      {%- liquid
        assign filter_by = 'theme.general.filter_by' | t
        assign title = results.title | escape | default: filter_by

        if request.page_type == 'collection' and collection.handle == 'all'
          assign title =  'theme.general.all_products_title' | t

          if current_tags.size == 1 and current_tags contains 'sale'
            assign title =  'theme.general.our_sales' | t
          endif
        endif

        if settings.filter_layout == 'outer'
          assign title = filter_by
        endif
      -%}
      <h2 class="h1-style">{{- title -}}</h2>

      <div class="category-page-items-count ProductCountDesktop">
        {%- if results.results_count -%}
          {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
        {%- elsif results.products_count == results.all_products_count -%}
          {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
        {%- else -%}
          {{ 'products.facets.product_count' | t: product_count: results.products_count, count: results.all_products_count }}
        {%- endif -%}
        {%- if collection.current_vendor -%}
          {{ 'theme.general.from_vendor' | t }}
        {%- endif -%}
      </div>
      {% render 'collection-subtitle' %}
    </div>
  {%- endif -%}
  <!-- /Page Title -->

  <div class="filter-mobile-content-scroll js-filter-desktop-wrap">
    {%- liquid
      assign current_active_values_count = false
      for filter in results.filters
        if filter.active_values.size > 0
          assign current_active_values_count =  true
          break
        endif
        if filter.type == "price_range"
          if filter.min_value.value > 0 or filter.max_value.value < filter.range_max
            assign current_active_values_count =  true
          endif
        endif
      endfor -%}
    <div class="active-facets-desktop">
      <div class="facets-container">
        <facet-filters-form class="facets small-hide">
          <save-attr>
            <form id="{{ id }}" class="facets__form">
              {%- if collection.current_vendor -%}
                <input type="hidden" name="q" value="{{ collection.current_vendor | escape }}" />
              {%- endif -%}
              {%- if collection.current_type -%}
                <input type="hidden" name="q" value="{{ collection.current_type | escape }}" />
              {%- endif -%}
              {%- if results.terms -%}
                <input type="hidden" name="q" value="{{ results.terms | escape }}">
                <input name="options[prefix]" type="hidden" value="last">
              {%- endif -%}
              {%- if template.suffix contains 'store-width-' -%}
                <input type="hidden" name="view" value="{{ template.suffix }}">
              {%- endif -%}
              {%- if enable_filtering -%}
                <div id="FacetsWrapperDesktop">
                  {%- if current_active_values_count -%}
                    <filter-block class="sidebar-block d-lg-none sidebar-block--static filter-group-block {{ filter_tab_status }} {% if current_active_values_count == 0 %}hidden{% endif %}">
                      <div class="sidebar-block_title heading-font">
                        <span class="sidebar-block_title_text">{{ 'theme.general.current_selection' | t | upcase }}</span>
                        <span class="toggle-arrow" data-toggle-collapse><span></span><span></span></span>
                      </div>
                      <div class="sidebar-block_content">
                        <ul class="tags-list">
                          {%- for filter in results.filters -%}
                            {% if filter.type == "price_range" %}
                              {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
                                {%- if filter.min_value.value > 0 or filter.max_value.value < filter.range_max -%}
                                  <facet-remove>
                                    <li><a href="{{ filter.url_to_remove }}"><span class="tags-list-close"></span><span>{% if filter.min_value.value %}{{ filter.min_value.value | money }}{% else -%}{{ 0 | money }}{% endif %}-{% if filter.max_value.value %}{{ filter.max_value.value | money }}{% else %}{{ filter.range_max | money }}{% endif %}<span class="visually-hidden">{{ 'theme.general.clear_filters' | t }}</span></span></a></li>
                                  </facet-remove>
                                {%- endif -%}
                              {%- endif -%}
                            {% endif %}
                            {%- for value in filter.active_values -%}
                              <facet-remove>
                                <li data-value="{{ value.label | escape }}">
                                  <a href="{{ value.url_to_remove }}"><span class="tags-list-close"></span><span>
                                      {%- if show_sizes and size_options_name == filter.label -%}
                                        {{ value.label | escape }}
                                      {%- else -%}
                                        {{ value.label | escape }}
                                      {%- endif -%}
                                    </span>
                                    {%- if show_colorpics and color_options_name contains filter.label -%}
                                      {%- liquid
                                        assign absent = false
                                        assign color_image_preffix = 'pill-pic-' | append: filter.label | handle | append: '-'
                                        assign color_pic_url =  color_image_preffix | append: value.label | handle | append: '.png' | file_img_url: width: '48', height: '48'
                                        assign color_pic_url_size = color_pic_url | split: '?' | last | size
                                        if color_pic_url_size <= 6
                                          assign absent = true
                                        endif
                                      -%}
                                      {%- unless absent -%}
                                        <span class="tags-list-color"><img src="{{ color_pic_url }}" alt="{{ value.label | escape }}" width="24" height="24"></span>
                                      {%- endunless -%}
                                    {%- endif -%}
                                  </a>
                                </li>
                              </facet-remove>
                            {%- endfor -%}
                          {%- endfor -%}
                        </ul>
                        <div class="mt-2" data-clear-filters>
                          <facet-remove>
                            <a href="{{ results_url }}" class="clear-filters"><span class="icon-wrap">{% render 'icon-remove2' %}</span><span>{{ 'theme.general.clear_filters' | t }}</span></a>
                          </facet-remove>
                        </div>
                      </div>
                    </filter-block>
                  {%- endif -%}

                  {%- if navigation_filter -%}
                    <filter-block class="sidebar-block filter-group-block {{ filter_tab_status }} js-filter"  id="Details-777-{{ section.id }}" data-index="777">
                      <div class="sidebar-block_title heading-font" data-save-attr='{ "filter-group-categories": {% if filter_tab_status == 'open' %}"close"{% else %}"open"{% endif %} }'>
                        <span class="sidebar-block_title_text">{{ 'theme.general.filter_categories' | t }}</span>
                        <span class="toggle-arrow" data-toggle-collapse><span></span></span>
                      </div>
                      <async-reload data-url-update>
                        <div class="sidebar-block_content has-scroll mt-0">
                          <div class="sidebar-block_content-scroll max-height" style="--max-height:480px">
                            <ul class="categories-menu">
                              {%- for link in navigation.links -%}
                                {%- if link.url contains '/collections/' -%}
                                  <li>
                                    {% render 'header-navigation-component-link', link: link, show_image_icons: false, show_collection_preview: false, show_collection_preview: false %}
                                    {%- if link.links.size > 0 -%}
                                      <ul class="categories-menu" style="display: none">
                                        {%- for childlink in link.links -%}
                                          {%- if childlink.url contains '/collections/' -%}
                                            <li>{% render 'header-navigation-component-link', link: childlink, show_image_icons: false, show_collection_preview: false, show_collection_preview: false %} </li>
                                          {%- endif -%}
                                        {%- endfor -%}
                                      </ul>
                                    {%- endif -%}
                                  </li>
                                {%- endif -%}
                              {%- endfor -%}
                            </ul>
                          </div>
                        </div>
                      </async-reload>
                    </filter-block>
                  {%- endif -%}

                  {%- for filter in results.filters -%}
                    {%- liquid
                      assign total_active_values = total_active_values | plus: filter.active_values.size
                    -%}

                    {%- case filter.type -%}
                      {%- when 'boolean' or 'list' -%}
                        {%- liquid
                          assign filter_values_count = 0

                          for value in filter.values
                            assign filter_values_count = filter_values_count | plus: value.count
                          endfor

                          if filter.active_values.size == 0 and filter_values_count == 0
                            continue
                          endif

                          assign has_scroll_and_search = false

                          if filter.values.size > 5
                            assign has_scroll_and_search = true
                          endif

                          assign colorpics = false

                          if show_colorpics and color_options_name contains filter.label
                            assign colorpics = true
                          endif

                          assign sizes = false

                          if show_sizes and size_options_name == filter.label
                            assign sizes = true
                            assign has_scroll_and_search = false

                            if filter.values.size > 16
                              assign sizes = false
                              assign has_scroll_and_search = true
                            endif
                          endif

                          assign filter_label = 'filter-group-' | append: filter.label | handle
                          assign filter_tab_status = cart.attributes[filter_label]

                          if filter_tab_status == nil
                            assign filter_tab_status = 'open'

                            if forloop.index < 7
                              assign filter_tab_status = 'open'
                            else
                              assign filter_tab_status = ''
                            endif
                          endif
                        -%}
                        <filter-block class="sidebar-block filter-group-block {{ filter_tab_status }} js-filter" id="Details-{{ forloop.index }}-{{ section.id }}" data-index="{{ forloop.index }}">
                          <div class="sidebar-block_title" data-save-attr='{ "filter-group-{{ filter.label | handle }}": {% if filter_tab_status == 'open' %}"close"{% else %}"open"{% endif %} }'>
                            <span class="sidebar-block_title_text heading-font">{{ filter.label | escape | upcase }}</span>
                            <span class="sidebar-block_selected facets__selected {% unless filter.active_values.size > 0 %} hidden{% endunless %}">
                              <facet-remove><a href="{{ filter.url_to_remove }}" title="{{ 'products.facets.reset' | t }}"><i class="filter-item">{{ 'products.facets.reset' | t }}</i></a></facet-remove>
                            </span>
                            <span class="toggle-arrow" data-toggle-collapse><span></span></span>
                          </div>
                          <div class="sidebar-block_content{% if has_scroll_and_search %} has-scroll  mt-0{% endif %}">
                          {%- if has_scroll_and_search -%}
                            <search-filter class="search-filter js-search-filter">
                              <div class="input-group mb-2">
                                <input class="form-control search " placeholder="{{ 'theme.general.search_product' | t }} {{ filter.label | escape | downcase }}"/>
                                <span class="icon-wrap">{% render 'icon-search' %}</span>
                                <a href="#" class="search-filter-clear js-search-filter-clear">{% render 'icon-close4' %}</a>
                              </div>
                              {%- endif -%}
                              <div class="{% if has_scroll_and_search %}sidebar-block_content-scroll{% endif %}" id="Facet-{{ forloop.index }}-{{ section.id }}">
                                {% if has_scroll_and_search %}
                                  <div class="search-filter-empty js-search-filter-empty d-none">{{ 'theme.general.no_matches' | t }}</div>
                                {% endif %}

                              {% if colorpics %}
                                <div class="js-filter-list {% if colorpics %}fieldset color-list two-column{% elsif sizes %}tags-list{% else %}category-list {% endif %} {% if has_scroll_and_search %}js-filter-list{% endif %}">
                                  {% else %}
                                  <fieldset class="js-filter-list {% if colorpics %}fieldset color-list two-column{% elsif sizes %}tags-list{% else %}category-list {% endif %} {% if has_scroll_and_search %}js-filter-list{% endif %}">
                                    {% endif %}

                                    {%- liquid
                                      assign filter_values_limit = 6

                                      if sizes == true
                                        assign filter_values_limit = 16
                                      endif

                                      if filter.values.size <= filter_values_limit
                                        for value in filter.values
                                          render 'facets-list', colorpics: colorpics, filter: filter, value: value, forloop: forloop, sizes: sizes, show: 'all'
                                        endfor
                                      else
                                        for value in filter.values
                                          render 'facets-list', colorpics: colorpics, filter: filter, value: value, forloop: forloop, sizes: sizes, show: 'enabled'
                                        endfor
                                        for value in filter.values
                                          render 'facets-list', colorpics: colorpics, filter: filter, value: value, forloop: forloop, sizes: sizes, show: 'disabled'
                                        endfor
                                      endif
                                    -%}

                                    {% if colorpics %}
                                </div>
                              {% else %}
                                </fieldset>
                                {% endif %}


                              </div>
                              {% if has_scroll_and_search %}
                            </search-filter>
                            {% endif %}
                          </div>
                        </filter-block>
                        {% liquid
                          assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
                          assign uses_comma_decimals = false
                          if currencies_using_comma_decimals contains cart.currency.iso_code
                            assign uses_comma_decimals = true
                          endif
                        %}

                      {%- when 'price_range' -%}

                        {% liquid
                          assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
                          assign uses_comma_decimals = false
                          assign step = 1

                          assign filter_min_value = filter.min_value.value | money_without_currency | replace: ',', ''
                          assign filter_max_value = filter.max_value.value | money_without_currency | replace: ',', '' | plus: 1
                          assign filter_range_max = filter.range_max | money_without_currency | replace: ',', '' | plus: 1

                          if currencies_using_comma_decimals contains cart.currency.iso_code
                            assign uses_comma_decimals = true
                            assign step = 1000
                            assign filter_min_value = filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '' | divided_by: 1000
                            assign filter_max_value = filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '' | divided_by: 1000
                            assign filter_range_max = filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '' | divided_by: 1000 | plus: 1
                          endif
                        %}
                        <filter-block class="sidebar-block open filter-group-block {% if forloop.first %}sidebar-block--heading-off{% endif %}" id="Details-{{ forloop.index }}-{{ section.id }}" data-index="{{ forloop.index }}">
                          <div class="sidebar-block_title heading-font">
                            <span class="sidebar-block_title_text">{{ filter.label | escape | upcase }}</span>
                            <span class="sidebar-block_selected" data-selected></span>
                            <span class="toggle-arrow" data-toggle-collapse><span></span></span>
                          </div>
                          <div class="sidebar-block_content mt-0">
                            <price-slider {% if uses_comma_decimals %}data-decimal{% endif %} class="price-slider--inputs">
                              <div>
                                <div class="inverse-left"></div>
                                <div class="inverse-right"></div>
                                <div class="price-slider-range"></div>
                                <span class="price-slider-thumb"></span>
                                <span class="price-slider-thumb"></span>
                              </div>
                              <input step="{{ step }}"
                                  name="{{ filter.min_value.param_name }}"
                                  id="Filter-{{ filter.label | escape }}-GTE"
                                  {%- if filter.min_value.value -%}
                                    value="{{ filter_min_value | times: step }}"
                                  {%- else -%}
                                    value="0"
                                  {%- endif -%}
                                  body-scroll-lock-ignore
                                  type="range"
                                  placeholder="0"
                                  min="0"
                                  class=""
                                  max="{{ filter_range_max | times: step }}"
                              >
                              <input step="{{ step }}"
                                  name="{{ filter.max_value.param_name }}"
                                  id="Filter-{{ filter.label | escape }}-LTE"
                                  {%- if filter.max_value.value -%}
                                    value="{{ filter_max_value | times: step }}"
                                  {% else %}
                                    value="{{ filter_range_max | times: step }}"
                                  {%- endif -%}
                                  body-scroll-lock-ignore
                                  type="range"
                                  min="0"
                                  class=""
                                  placeholder="{{ filter_range_max | times: step }}"
                                  max="{{ filter_range_max | times: step }}"
                              >
                              <span class="price-slider-inputs">
                                <span>
                                  <label data-tippy-content="{{ localization.country.currency.name }} ({{ localization.country.currency.iso_code }})">{{ 'theme.general.from' | t }}, {{ cart.currency.symbol }}</label>
                                  {% if uses_comma_decimals %}<input class="form-control help-input" type="text">{% endif %}
                                  <input class="form-control {% if uses_comma_decimals %}hidden{% endif %}" type="number"

                                      {%- if filter.min_value.value -%}
                                        value="{{ filter_min_value | times: step }}"
                                      {%- else -%}
                                        value="0"
                                      {%- endif -%}
                                      placeholder="0"
                                      min="0"
                                      max="{{ filter_range_max | times: step }}"

                                      {%- if filter.min_value.value -%}
                                        data-value="{{ filter_min_value | times: step }}"
                                      {%- else -%}
                                        data-value="0"
                                      {%- endif -%}
                                  >
                                </span>
                                <span><i></i>{% render 'icon-alert' %}</span>
                                <span>
                                  <label data-tippy-content="{{ localization.country.currency.name }} ({{ localization.country.currency.iso_code }})">{{ 'theme.general.to' | t }}, {{ cart.currency.symbol }}</label>
                                  {% if uses_comma_decimals %}<input class="form-control help-input" type="text">{% endif %}
                                  <input class="form-control {% if uses_comma_decimals %}hidden{% endif %}" type="number"

                                      {%- if filter.max_value.value -%}
                                        value="{{ filter_max_value | times: step }}"
                                      {% else %}
                                        value="{{ filter_range_max | times: step }}"
                                      {%- endif -%}
                                      min="0"
                                      class=""
                                      placeholder="{{ filter_range_max | times: step }}"
                                      max="{{ filter_range_max | times: step }}"

                                      {%- if filter.max_value.value -%}
                                        data-value="{{ filter_max_value | times: step }}"
                                      {% else %}
                                        data-value="{{ filter_range_max | times: step }}"
                                      {%- endif -%}
                                  >
                                </span>
                              </span>
                            </price-slider>
                          </div>
                        </filter-block>
                    {%- endcase -%}

                  {%- endfor -%}
                </div>
              {%- endif -%}
            </form>
          </save-attr>
        </facet-filters-form>
      </div>
    </div>
  </div>
</div>