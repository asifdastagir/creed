{% comment %}theme-check-disable NestedSnippet, UnusedAssign{% endcomment %}
{%- liquid
  assign paginate_limit = settings.collection_products_per_page

  assign store_width = settings.container_max_width

  if section.settings.section_width == 'custom'
    assign store_width = section.settings.container_max_width
  endif

  if template.suffix contains 'store-width-'
    assign store_width = template.suffix | split: 'store-width-' | last | plus: 0
  endif
-%}

{%- paginate collection.products by paginate_limit -%}
  {%- liquid
    assign current_count = paginate.current_page | times: paginate_limit
    assign show = true

    if current_count > settings.limit_infinite
      assign show = false
    endif
  -%}
  {%- if show -%}
    <div class="swiper product-swiper swiper-container">
      <div class="swiper-wrapper">
        {%- for product in collection.products limit: paginate_limit -%}
          {%- liquid
            if product.id == current_product.id
              continue
            endif
          -%}
          <div class="swiper-slide recommended-product">  
            {% render 'product-card', product: product, collection: collection %}
          </div>
        {%- endfor -%}
      </div>

      <!-- Swiper navigation & pagination -->
      <div class="swiper-pagination"></div>
      <div class="swiper-arrows-carousel container">
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>
    </div>

    {%- if paginate.pages > 1 and paginate.parts.size > 0 -%}
      {% render 'async-pagination-hidden',
        paginate: paginate,
        results: collection,
        container: '.product-swiper .swiper-wrapper'
      %}
    {%- endif -%}
  {%- endif -%}
{%- endpaginate -%}


